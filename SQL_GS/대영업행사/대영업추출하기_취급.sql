
-- 입고수량 기준과 판매수량 기준이 달라서 따로 추출함. MD100Unit gopa1, gopa2 / 범상치 gopa3, gopa4  로 각각 묶어서 마지막 서브쿼리로 묶음. SELECT * from (gopa1=gopa2) full outer join (gopa3=gopa4)

with  gopa1 as (
    select	a11.GOODCD  GOODCD,
	a11.STORECD  STORECD,
	sum(a11.IN_QTY)  입고수량
    from	LGMJVDP.TB_STK_FT	a11
    where	(a11.GOODCD in ('8801068399189', '8801068395822', '8801155721541', '8801155721510', '8801155721527', '8801155721534', '2345001795394', '2345001795417', '2345001732818', '4005808517572', '4005808373000', '2345001753998', '8809038478421', '8809038478438', '8801021213217', '786150000236', '8801021214320', '8801021227139', '8801021223575', '8809556111411', '8809556111459', '8809556111435', '4740098095408', '4740098095422', '8809546060583', '8801019998041', '8801019901171', '8801052043845', '8801052043852', '8801118257025', '8809713220109', '8801104666404', '8801118256721', '8801118257155', '8801062623471', '8801097235014', '8806002017990', '8801105910391', '8801105913231', '8801105914382', '8801105914610', '8801056178086', '8801056178116', '8801056104641', '8801056177553', '8801155741792', '8801155741785', '8801155741778', '8801111905299', '8801111943376', '8801111947435', '8801111947596', '8801111916479', '8801019204951', '8801019207655', '8801019306495', '8801019315725', '8801019608766', '8801062870585', '8801062870967', '8801062870929', '8801062873487', '8801062870448', '8801062872138', '8801062870462', '8801062873340', '8801062873333', '8801047170945', '8801047170952', '8801047170969', '8801047161578', '8801047161585', '8801047161592', '8801047161608', '8801047161646', '8801047161653', '8801045702643', '8801045574585', '8801045224091', '8801045812496', '8801045572826', '8801045573090', '8801045813769', '8801038572291', '8809535596611', '8809535593467', '8806127207511', '8804582021383', '8804582023417', '8809723786589', '8801108000297', '8801008021200', '8809086623897', '8809086623903', '8809756290176', '8809756290183')
        and a11.DATECD BETWEEN ('2021-12-27') and ('2022-01-31'))
    group by	a11.GOODCD,
    	a11.STORECD
),
gopa2 as (
    select	a11.GOODCD  GOODCD,
	a11.STORECD  STORECD,
	sum(a11.SAL_QTY)  판매수량
    from	LGMJVDP.TB_STK_FT	a11
    where	(a11.GOODCD in ('8801068399189', '8801068395822', '8801155721541', '8801155721510', '8801155721527', '8801155721534', '2345001795394', '2345001795417', '2345001732818', '4005808517572', '4005808373000', '2345001753998', '8809038478421', '8809038478438', '8801021213217', '786150000236', '8801021214320', '8801021227139', '8801021223575', '8809556111411', '8809556111459', '8809556111435', '4740098095408', '4740098095422', '8809546060583', '8801019998041', '8801019901171', '8801052043845', '8801052043852', '8801118257025', '8809713220109', '8801104666404', '8801118256721', '8801118257155', '8801062623471', '8801097235014', '8806002017990', '8801105910391', '8801105913231', '8801105914382', '8801105914610', '8801056178086', '8801056178116', '8801056104641', '8801056177553', '8801155741792', '8801155741785', '8801155741778', '8801111905299', '8801111943376', '8801111947435', '8801111947596', '8801111916479', '8801019204951', '8801019207655', '8801019306495', '8801019315725', '8801019608766', '8801062870585', '8801062870967', '8801062870929', '8801062873487', '8801062870448', '8801062872138', '8801062870462', '8801062873340', '8801062873333', '8801047170945', '8801047170952', '8801047170969', '8801047161578', '8801047161585', '8801047161592', '8801047161608', '8801047161646', '8801047161653', '8801045702643', '8801045574585', '8801045224091', '8801045812496', '8801045572826', '8801045573090', '8801045813769', '8801038572291', '8809535596611', '8809535593467', '8806127207511', '8804582021383', '8804582023417', '8809723786589', '8801108000297', '8801008021200', '8809086623897', '8809086623903', '8809756290176', '8809756290183')
        and a11.DATECD BETWEEN ('2022-01-01') and ('2022-01-31'))
    group by	a11.GOODCD,
    	a11.STORECD
), gopa3 as (
    select	a11.GOODCD  GOODCD,
	a11.STORECD  STORECD,
	sum(a11.IN_QTY)  입고수량
    from	LGMJVDP.TB_STK_FT	a11
    where	(a11.GOODCD in ('8801073110502', '8801073102538', '8801123307630', '8801123309498', '9323956012240', '8801111186582', '4005808517572', '4005808372881', '4005808373000', '4005808517589', '8809180740759', '8801056177294', '8804127012777', '8809102956213', '8801308448912', '8801308447489', '8802456107072', '8801047183617', '8801047183655', '8801047183679', '8886467105333', '8886467105357', '8809061679147', '8802774013598', '8802774014472', '8801038572307', '8809709260102', '8809709260201', '8801051215182', '2700038835862', '2700038817868', '2700038836159', '2700038828550', '2345000653671', '2345001789454', '3415581102291', '3415581126297', '3415581119299', '3415582302294', '3415582300290', '3415581101294', '3415581105292', '3415587167294', '3415581152296', '3415587174292', '3415581115291', '2700038835855', '2700038817837', '2700038836142', '2700038828543', '2800100122507', '2800100122576', '2800100122583', '2800100122521', '2800100122538', '2800100122606', '2800100122545', '2800100129919', '2800100122552'
)
        and a11.DATECD BETWEEN ('2021-12-27') and ('2022-01-07'))
    group by	a11.GOODCD,
    	a11.STORECD
),
gopa4 as (
    select	a11.GOODCD  GOODCD,
	a11.STORECD  STORECD,
	sum(a11.SAL_QTY)  판매수량
    from	LGMJVDP.TB_STK_FT	a11
    where	(a11.GOODCD in ('8801073110502', '8801073102538', '8801123307630', '8801123309498', '9323956012240', '8801111186582', '4005808517572', '4005808372881', '4005808373000', '4005808517589', '8809180740759', '8801056177294', '8804127012777', '8809102956213', '8801308448912', '8801308447489', '8802456107072', '8801047183617', '8801047183655', '8801047183679', '8886467105333', '8886467105357', '8809061679147', '8802774013598', '8802774014472', '8801038572307', '8809709260102', '8809709260201', '8801051215182', '2700038835862', '2700038817868', '2700038836159', '2700038828550', '2345000653671', '2345001789454', '3415581102291', '3415581126297', '3415581119299', '3415582302294', '3415582300290', '3415581101294', '3415581105292', '3415587167294', '3415581152296', '3415587174292', '3415581115291', '2700038835855', '2700038817837', '2700038836142', '2700038828543', '2800100122507', '2800100122576', '2800100122583', '2800100122521', '2800100122538', '2800100122606', '2800100122545', '2800100129919', '2800100122552')
        and a11.DATECD BETWEEN ('2022-01-01') and ('2022-01-07'))
    group by	a11.GOODCD,
    	a11.STORECD
) 

select 
    SA1.STORECD,
    SA1.MD상품,
    SA2.범상치
from 
    (
        select
            pa1.STORECD STORECD,
            sum(CASE WHEN pa1.입고수량 >0 OR pa2.판매수량 > 0 THEN 1 ELSE 0 END) AS MD상품
        from gopa1 pa1 
            full outer join gopa2 pa2 on pa1.STORECD = pa2.STORECD and pa1.GOODCD = pa2.GOODCD
        group by pa1.STORECD
    ) SA1  -- MD100 UNIT
        full outer join 
    (
        select
            pa3.STORECD STORECD,
            sum(CASE WHEN pa3.입고수량 >0 OR pa4.판매수량 > 0 THEN 1 ELSE 0 END) AS 범상치
        from gopa3 pa3 
            full outer join gopa4 pa4 on pa3.STORECD = pa4.STORECD and pa3.GOODCD = pa4.GOODCD
        group by pa3.STORECD
    ) SA2  -- 범상치 유닛
    on SA1.STORECD = SA2.STORECD


---------------------------------------------- 3지역만 뽑기

with  gopa1 as (
    select	a11.GOODCD  GOODCD,
	a11.STORECD  STORECD,
	sum(a11.IN_QTY)  입고수량
    from	LGMJVDP.TB_STK_FT	a11
    left join LGMJVDP.TB_STORE_DM a12 on a11.STORECD = a12.STORECD
    where	(a11.GOODCD in ('8801068399189', '8801068395822', '8801155721541', '8801155721510', '8801155721527', '8801155721534', '2345001795394', '2345001795417', '2345001732818', '4005808517572', '4005808373000', '2345001753998', '8809038478421', '8809038478438', '8801021213217', '786150000236', '8801021214320', '8801021227139', '8801021223575', '8809556111411', '8809556111459', '8809556111435', '4740098095408', '4740098095422', '8809546060583', '8801019998041', '8801019901171', '8801052043845', '8801052043852', '8801118257025', '8809713220109', '8801104666404', '8801118256721', '8801118257155', '8801062623471', '8801097235014', '8806002017990', '8801105910391', '8801105913231', '8801105914382', '8801105914610', '8801056178086', '8801056178116', '8801056104641', '8801056177553', '8801155741792', '8801155741785', '8801155741778', '8801111905299', '8801111943376', '8801111947435', '8801111947596', '8801111916479', '8801019204951', '8801019207655', '8801019306495', '8801019315725', '8801019608766', '8801062870585', '8801062870967', '8801062870929', '8801062873487', '8801062870448', '8801062872138', '8801062870462', '8801062873340', '8801062873333', '8801047170945', '8801047170952', '8801047170969', '8801047161578', '8801047161585', '8801047161592', '8801047161608', '8801047161646', '8801047161653', '8801045702643', '8801045574585', '8801045224091', '8801045812496', '8801045572826', '8801045573090', '8801045813769', '8801038572291', '8809535596611', '8809535593467', '8806127207511', '8804582021383', '8804582023417', '8809723786589', '8801108000297', '8801008021200', '8809086623897', '8809086623903', '8809756290176', '8809756290183','8801073110502', '8801073102538', '8801123307630', '8801123309498', '9323956012240', '8801111186582', '4005808517572', '4005808372881', '4005808373000', '4005808517589', '8809180740759', '8801056177294', '8804127012777', '8809102956213', '8801308448912', '8801308447489', '8802456107072', '8801047183617', '8801047183655', '8801047183679', '8886467105333', '8886467105357', '8809061679147', '8802774013598', '8802774014472', '8801038572307', '8809709260102', '8809709260201', '8801051215182', '2700038835862', '2700038817868', '2700038836159', '2700038828550', '2345000653671', '2345001789454', '3415581102291', '3415581126297', '3415581119299', '3415582302294', '3415582300290', '3415581101294', '3415581105292', '3415587167294', '3415581152296', '3415587174292', '3415581115291', '2700038835855', '2700038817837', '2700038836142', '2700038828543', '2800100122507', '2800100122576', '2800100122583', '2800100122521', '2800100122538', '2800100122606', '2800100122545', '2800100129919', '2800100122552')
        and a11.DATECD BETWEEN ('2021-12-27') and ('2022-01-31'))
        and a12.RGNCD in ('54')
    group by	a11.GOODCD,
    	a11.STORECD
),
gopa2 as (
    select	a11.GOODCD  GOODCD,
	a11.STORECD  STORECD,
	sum(a11.SAL_QTY)  판매수량
    from	LGMJVDP.TB_STK_FT	a11
    left join LGMJVDP.TB_STORE_DM a12 on a11.STORECD = a12.STORECD
    where	(a11.GOODCD in ('8801068399189', '8801068395822', '8801155721541', '8801155721510', '8801155721527', '8801155721534', '2345001795394', '2345001795417', '2345001732818', '4005808517572', '4005808373000', '2345001753998', '8809038478421', '8809038478438', '8801021213217', '786150000236', '8801021214320', '8801021227139', '8801021223575', '8809556111411', '8809556111459', '8809556111435', '4740098095408', '4740098095422', '8809546060583', '8801019998041', '8801019901171', '8801052043845', '8801052043852', '8801118257025', '8809713220109', '8801104666404', '8801118256721', '8801118257155', '8801062623471', '8801097235014', '8806002017990', '8801105910391', '8801105913231', '8801105914382', '8801105914610', '8801056178086', '8801056178116', '8801056104641', '8801056177553', '8801155741792', '8801155741785', '8801155741778', '8801111905299', '8801111943376', '8801111947435', '8801111947596', '8801111916479', '8801019204951', '8801019207655', '8801019306495', '8801019315725', '8801019608766', '8801062870585', '8801062870967', '8801062870929', '8801062873487', '8801062870448', '8801062872138', '8801062870462', '8801062873340', '8801062873333', '8801047170945', '8801047170952', '8801047170969', '8801047161578', '8801047161585', '8801047161592', '8801047161608', '8801047161646', '8801047161653', '8801045702643', '8801045574585', '8801045224091', '8801045812496', '8801045572826', '8801045573090', '8801045813769', '8801038572291', '8809535596611', '8809535593467', '8806127207511', '8804582021383', '8804582023417', '8809723786589', '8801108000297', '8801008021200', '8809086623897', '8809086623903', '8809756290176', '8809756290183','8801073110502', '8801073102538', '8801123307630', '8801123309498', '9323956012240', '8801111186582', '4005808517572', '4005808372881', '4005808373000', '4005808517589', '8809180740759', '8801056177294', '8804127012777', '8809102956213', '8801308448912', '8801308447489', '8802456107072', '8801047183617', '8801047183655', '8801047183679', '8886467105333', '8886467105357', '8809061679147', '8802774013598', '8802774014472', '8801038572307', '8809709260102', '8809709260201', '8801051215182', '2700038835862', '2700038817868', '2700038836159', '2700038828550', '2345000653671', '2345001789454', '3415581102291', '3415581126297', '3415581119299', '3415582302294', '3415582300290', '3415581101294', '3415581105292', '3415587167294', '3415581152296', '3415587174292', '3415581115291', '2700038835855', '2700038817837', '2700038836142', '2700038828543', '2800100122507', '2800100122576', '2800100122583', '2800100122521', '2800100122538', '2800100122606', '2800100122545', '2800100129919', '2800100122552')
        and a11.DATECD BETWEEN ('2022-01-01') and ('2022-01-31'))
        and a12.RGNCD in ('54')
    group by	a11.GOODCD,
    	a11.STORECD
)
select 
    SA1.STORECD,
    SUBSTR(SA3.STORENM,1,INSTR(SA3.STORENM,'(')-1 ) STORENM,
    SA3.TEAM_LN,
    SA3.RGNNM,
    SA1.GOODCD,
    SA4.GOODNM,
    SA1.입고수량,
    SA2.판매수량
from
    gopa1 SA1
    full outer join gopa2 SA2 on SA1.STORECD = SA2.STORECD and SA1.GOODCD = SA2.GOODCD
    left join LGMJVDP.TB_STORE_DM SA3 on SA1.STORECD = SA3.STORECD
    left join LGMJVDP.TB_GOOD_DM SA4 on SA1.GOODCD = SA4.GOODCD
order by SA1.STORECD, SA1.GOODCD


















