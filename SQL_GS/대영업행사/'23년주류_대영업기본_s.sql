with     gopa1 as
 (select    a11.STORECD  STORECD,
        sum(a11.NTSAL_AMT) AS 우유_매출액,
        sum(case when (a11.ODR_QTY > 0 or a11.SAL_QTY > 0) and  a11.GOODCD in ('8801069419633', '8801069416212', '8801104944298', '8801069417165', '8801104675871', '8801104675864', '8801104675888', '8801121772874', '8801121772881', '8801104250627', '8801104240284', '8801155744090', '8801155744106', '8801155744113', '8801115134039', '8801115134237', '8801115134435', '8801115114727') then 1 else 0 end) AS 취급상품수
    from    LGMJVDP.TB_STK_MSG_AG    a11
        join    LGMJVDP.TB_STORE_DM    a12
          on     (a11.STORECD = a12.STORECD)
          and a12.OPENDT < ('2024-03-11')
    where    (a11.YMCD in ('202404')
     and a11.GOODCD in ('8801115215851', '8801115224143', '8801104666152', '8801104666176', '8801069183565', '8801069419169', '8801115134220', '8801115134213', '8801115137290', '8801115135708', '8801115212713', '8801115213543', '8801115213604', '8801121107935', '8801121107942', '8801121106792', '8801121755679', '8801121761823', '8801121768167', '8801121768174', '8801121771396', '8801121771402', '8801121040416', '8801104670876', '8801104673198', '8801104673211', '8801104942935', '8801069415833', '8801069416007', '8801069417554', '8801069419619', '8801069420257', '8801069420271', '8801155741822', '8801155741839', '8801155741853', '8801155741877', '8801155741846', '8801155741860', '8809226406847', '8801121767122', '8801121767139', '8801121770757', '8801128000611', '8801128000635', '8801128280631', '8801128243599', '8801104212403', '8801104212601', '8801104212397', '8801069419633', '8801069416212', '8801104944298', '8801069417165', '8801104675871', '8801104675864', '8801104675888', '8801121772874', '8801121772881', '8801104250627', '8801104240284', '8801155744090', '8801155744106', '8801155744113', '8801115134039', '8801115134237', '8801115134435', '8801115114727')
     and a12.RGNCD between ('41') and ('61')
     and a12.TEAMCD not in ('4208') )
    group by    a11.STORECD
    ), 
     gopa2 as
 (select    a11.STORECD  STORECD,
        sum(a11.SALDT_CNT)  영업일수
    from    LGMJVDP.TB_SALDT_MS_AG    a11
        join    LGMJVDP.TB_STORE_DM    a12
          on     (a11.STORECD = a12.STORECD)
          and a12.OPENDT < ('2024-03-11')
    where    (a11.YMCD in ('202404')
     and a12.RGNCD between ('41') and ('61')
     and a12.TEAMCD not in ('4208') )
    group by    a11.STORECD
    )
select    distinct pa11.STORECD  STORECD,
    'V'||SUBSTR(a13.STORENM,INSTR(a13.STORENM,'(')+1, -( INSTR(a13.STORENM,'(') -INSTR(a13.STORENM,':'))-1)  현재코드,
    SUBSTR(a13.STORENM,1,INSTR(a13.STORENM,'(')-1 )  STORENM,
    a13.TEAM_LN  TEAM_LN,
    a13.PART_LN  PART_LN,
    a13.OPENDT  오픈일,
    pa11.우유_매출액,
    pa11.취급상품수,
    pa12.영업일수
from    gopa1    pa11
    left outer join    gopa2    pa12
      on     (pa11.STORECD = pa12.STORECD)
    join    LGMJVDP.TB_STORE_DM    a13
      on     (pa11.STORECD = a13.STORECD 
      and     pa11.STORECD = a13.STORECD)






      --------------------   매출이익 포함


      with     gopa1 as
 (select    a11.STORECD  STORECD,
        sum(a11.SALPRF_AMT) AS 행사상품_매출이익,
        sum(case when a11.SALPRF_AMT > 0 then 1 else 0 end ) AS 상품취급
        from    LGMJVDP.TB_STK_MSG_AG    a11
        join    LGMJVDP.TB_STORE_DM    a12
        on     (a11.STORECD = a12.STORECD)
        and a12.OPENDT < ('2024-01-11')
        where    (a11.YMCD in ('202402','202403')
        and a11.GOODCD in ('8801062870585', '8801062628476', '8801062641826', '8801062641895', '8801062642021', '8801062860197', '8801062860159', '9556001216144', '9556001284358', '50426416', '3045140105502', '8804973308802', '8804973308789', '8801043067317', '6921211104292', '8801043068178', '9300682051507', '9300682053761', '4902750435230')
        and a12.RGNCD between ('41') and ('61'))
        group by    a11.STORECD
    ), 
     gopa2 as
 (select    a11.STORECD  STORECD,
        sum(a11.SALDT_CNT)  영업일수
    from    LGMJVDP.TB_SALDT_MS_AG    a11
        join    LGMJVDP.TB_STORE_DM    a12
          on     (a11.STORECD = a12.STORECD)
          and a12.OPENDT < ('2024-01-11')
    where    (a11.YMCD in ('202402','202403')
     and a12.RGNCD between ('41') and ('61'))
    group by    a11.STORECD
    )
select    distinct pa11.STORECD  STORECD,
    'V'||SUBSTR(a13.STORENM,INSTR(a13.STORENM,'(')+1, -( INSTR(a13.STORENM,'(') -INSTR(a13.STORENM,':'))-1)  현재코드,
    SUBSTR(a13.STORENM,1,INSTR(a13.STORENM,'(')-1 )  STORENM,
    a13.TEAM_LN  TEAM_LN,
    a13.PART_LN  PART_LN,
    a13.OPENDT  오픈일,
    pa11.행사상품_매출이익,
    pa11.상품취급,
    pa12.영업일수
from    gopa1    pa11
    left outer join    gopa2    pa12
      on     (pa11.STORECD = pa12.STORECD)
    join    LGMJVDP.TB_STORE_DM    a13
      on     (pa11.STORECD = a13.STORECD 
      and     pa11.STORECD = a13.STORECD)