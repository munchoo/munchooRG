with	 gopa1 as
 (select	a11.STORECD  STORECD,
		sum(case when a11.GOODCD in ('8801021232591', '8801021232539', '8801021105833', '8712000900045', '8712000052973', '8712000057190', '6901035603232', '6901035627047', '6901035607230', '3080216031811', '5901594001389', '5740700987502', '4901004006813', '4901004006714') then a11.NTSAL_AMT end) AS 행사매출액,
		sum(case when a11.GOODCD in ('8801021232591', '8801021232539', '8801021105833', '8712000900045', '8712000052973', '8712000057190', '6901035603232', '6901035627047', '6901035607230', '3080216031811', '5901594001389', '5740700987502', '4901004006813', '4901004006714') then a11.SALPRF_AMT end) AS 행사매출이익,
		sum(case when a11.GOODCD in ('8809311399818', '8888017220046', '8888017200185', '8888017200215', '8801021106427', '8801030949480', '8809556112210', '8654000100417', '8809861950248', '8809861950026', '8809861950002') then a11.NTSAL_AMT end) AS 전략매출액,
		sum(case when a11.GOODCD in ('8809311399818', '8888017220046', '8888017200185', '8888017200215', '8801021106427', '8801030949480', '8809556112210', '8654000100417', '8809861950248', '8809861950026', '8809861950002') then a11.SALPRF_AMT end) AS 전략매출이익
	from	LGMJVDP.TB_STK_MSG_AG	a11
		join	LGMJVDP.TB_STORE_DM	a12
		  on 	(a11.STORECD = a12.STORECD)
		  and a12.OPENDT < ('2023-07-11')
	where	(a11.YMCD in ('202308')
	 and a11.GOODCD in ('8801021232591', '8801021232539', '8801021105833', '8712000900045', '8712000052973', '8712000057190', '6901035603232', '6901035627047', '6901035607230', '3080216031811', '5901594001389', '5740700987502', '4901004006813', '4901004006714', '8809311399818', '8888017220046', '8888017200185', '8888017200215', '8801021106427', '8801030949480', '8809556112210', '8654000100417', '8809861950248', '8809861950026', '8809861950002')
	 and a12.RGNCD in ('54'))
	group by	a11.STORECD
	), 
	 gopa2 as
 (select	a11.STORECD  STORECD,
		sum(a11.SALDT_CNT)  영업일수
	from	LGMJVDP.TB_SALDT_MS_AG	a11
		join	LGMJVDP.TB_STORE_DM	a12
		  on 	(a11.STORECD = a12.STORECD)
		  and a12.OPENDT < ('2023-07-11')
	where	(a11.YMCD in ('202308')
	 and a12.RGNCD in ('54'))
	group by	a11.STORECD
	)
select	distinct pa11.STORECD  STORECD,
	'V'||SUBSTR(a13.STORENM,INSTR(a13.STORENM,'(')+1, -( INSTR(a13.STORENM,'(') -INSTR(a13.STORENM,':'))-1)  현재코드,
	SUBSTR(a13.STORENM,1,INSTR(a13.STORENM,'(')-1 )  STORENM,
	a13.TEAM_LN  TEAM_LN,
	a13.PART_LN  PART_LN,
	a13.OPENDT  오픈일,
	pa11.행사매출액,
	pa11.행사매출이익,
	pa11.전략매출액,
	pa11.전략매출이익,
	pa12.영업일수
from	gopa1	pa11
	left outer join	gopa2	pa12
	  on 	(pa11.STORECD = pa12.STORECD)
	join	LGMJVDP.TB_STORE_DM	a13
	  on 	(pa11.STORECD = a13.STORECD 
	  and 	pa11.STORECD = a13.STORECD)




--- 주류일매출
with  gopa1 as
 (select a11.STORECD  STORECD,
sum(a11.NTSAL_AMT)  WJXBFS1
from LGMJVDP.TB_STK_MSG1_AG a11
join LGMJVDP.TB_GOOD_CLS1_DM a13
  on  (a11.GOOD_CLS1CD = a13.GOOD_CLS1CD)
join LGMJVDP.TB_STORE_DM a14
  on  (a11.STORECD = a14.STORECD)
where (a13.GOOD_CLS0CD in ('12')
 and a14.RGNCD in ('54'))
 and a11.YMCD in ('202208')
group by a11.STORECD
), 
 gopa2 as
 (select a11.STORECD  STORECD,
sum(a11.SALDT_CNT)  WJXBFS1
from LGMJVDP.TB_SALDT_MS_AG a11
join LGMJVDP.TB_STORE_DM a13
  on  (a11.STORECD = a13.STORECD)
where a13.RGNCD in ('54')
and a11.YMCD in ('202208')
group by a11.STORECD
), 
 gopa3 as
 (select coalesce(pa11.STORECD, pa12.STORECD)  STORECD,
pa11.WJXBFS1  WJXBFS1,
pa12.WJXBFS1  WJXBFS2
from gopa1 pa11
full outer join gopa2 pa12
  on  (pa11.STORECD = pa12.STORECD)
), 
 gopa4 as
 (select a11.STORECD  STORECD,
sum(a11.SALDT_CNT)  WJXBFS1
from LGMJVDP.TB_SALDT_MS_AG a11
join LGMJVDP.TB_STORE_DM a12
  on  (a11.STORECD = a12.STORECD)
where (a11.YMCD in ('202308')
 and a12.RGNCD in ('54'))
group by a11.STORECD
), 
 gopa5 as
 (select a11.STORECD  STORECD,
sum(a11.NTSAL_AMT)  WJXBFS1
from LGMJVDP.TB_STK_MSG1_AG a11
join LGMJVDP.TB_GOOD_CLS1_DM a12
  on  (a11.GOOD_CLS1CD = a12.GOOD_CLS1CD)
join LGMJVDP.TB_STORE_DM a13
  on  (a11.STORECD = a13.STORECD)
where (a11.YMCD in ('202308')
 and a12.GOOD_CLS0CD in ('12')
 and a13.RGNCD in ('54'))
group by a11.STORECD
), 
 gopa6 as
 (select coalesce(pa11.STORECD, pa12.STORECD)  STORECD,
pa11.WJXBFS1  WJXBFS1,
pa12.WJXBFS1  WJXBFS2
from gopa4 pa11
full outer join gopa5 pa12
  on  (pa11.STORECD = pa12.STORECD)
), 
 gopa7 as
 (select a11.STORECD  STORECD,
sum(a11.SALDT_CNT)  WJXBFS1
from LGMJVDP.TB_SALDT_MS_AG a11
join LGMJVDP.TB_STORE_DM a12
  on  (a11.STORECD = a12.STORECD)
where (a11.YMCD in ('202307')
 and a12.RGNCD in ('54'))
group by a11.STORECD
), 
 gopa8 as
 (select a11.STORECD  STORECD,
sum(a11.NTSAL_AMT)  WJXBFS1
from LGMJVDP.TB_STK_MSG1_AG a11
join LGMJVDP.TB_GOOD_CLS1_DM a12
  on  (a11.GOOD_CLS1CD = a12.GOOD_CLS1CD)
join LGMJVDP.TB_STORE_DM a13
  on  (a11.STORECD = a13.STORECD)
where (a11.YMCD in ('202307')
 and a12.GOOD_CLS0CD in ('12')
 and a13.RGNCD in ('54'))
group by a11.STORECD
), 
 gopa9 as
 (select coalesce(pa11.STORECD, pa12.STORECD)  STORECD,
pa11.WJXBFS1  WJXBFS1,
pa12.WJXBFS1  WJXBFS2
from gopa7 pa11
full outer join gopa8 pa12
  on  (pa11.STORECD = pa12.STORECD)
)
select trim(coalesce(pa11.STORECD, pa12.STORECD, pa13.STORECD))  STORECD,
pa11.WJXBFS1  전년매출액,
pa11.WJXBFS2  전년영업일수,
pa12.WJXBFS1  영업일수,
pa12.WJXBFS2  매출액,
pa13.WJXBFS1  군영업일수,
pa13.WJXBFS2  군매출액
from gopa3 pa11
full outer join gopa6 pa12
  on  (pa11.STORECD = pa12.STORECD)
full outer join gopa9 pa13
  on  (pa11.STORECD = pa13.STORECD)  
join LGMJVDP.TB_STORE_DM a13
  on  (coalesce(pa11.STORECD, pa12.STORECD, pa13.STORECD) = a13.STORECD) 
  
  
 
